<!doctype html>

<html>

<head>


    <script src="maps/map1/mapBeats1.js"></script>
</head>
<meta charset="UTF-8">

<body>
    <div>
        <canvas id="gameCanvas">
            <script>
                var canvas, canvasContext;
                window.onload = function() {
                    canvas = document.getElementById("gameCanvas");
                    canvasContext = canvas.getContext('2d');

                    canvas.addEventListener("click", function(evt) {
                        var mousePos = getMousePos(canvas, evt);
                        //                        console.log(mousePos.x + ',' + mousePos.y);
                        mouse[0] = mousePos.x;
                        mouse[1] = mousePos.y;
                        beatHitDetect();
                    }, false);


                    setInterval(mainloop, 1000 / 60);
                    resizeCanvas();
                }

                function mainloop() {
                    colourRect(0, 0, canvas.width, canvas.height, "rgb(1,1,1,1)");
                    connectBeats()
                    drawCurrentBeats();
                    mapTimer += 1;
                    //                    console.log(mapTimer);
                }
                var mapTimer = 0;
                var DefaultBeatTime = 30;
                var mouse = [0, 0];
                var defaultBeat = {
                    radius: 30,
                    colour: "rgb(254,0,0,1)",
                    Bordersize: 5,
                    BorderColour: "rgb(0,254,0,1)"
                }
                var lineConnectionColour = "rgb(255,0,0,0.5)";
                var currentMap;
                var beats = [
                    [
                        0, [300, 200], 50, defaultBeat.colour, defaultBeat.Bordersize, defaultBeat.BorderColour
                    ], //
                    [
                        500, [800, 300]
                    ],
                    [
                        700, [500, 400]
                    ],
                    [
                        700, [700, 100]
                    ]
                ];

                function drawLines(x1, y1, x2, y2, c) {
                    canvasContext.strokeStyle = c;
                    canvasContext.beginPath();
                    canvasContext.moveTo(x1, y1);
                    canvasContext.lineTo(x2, y2);
                    canvasContext.closePath();
                    canvasContext.stroke()
                }

                function connectBeats() {
                    for (let i = 0; i < beats.length - 1; i++) {
                        drawLines(beats[i][1][0], beats[i][1][1], beats[i + 1][1][0], beats[i + 1][1][1], lineConnectionColour)
                    }
                }

                function drawCurrentBeats() {
                    beats.forEach(Element => {
                        if (Element.length > 2) {
                            drawCircle(Element[1][0], Element[1][1], Element[2], Element[3], Element[4], Element[5]);
                        } else {
                            drawCircle(Element[1][0], Element[1][1], defaultBeat.radius, defaultBeat.colour, defaultBeat.Bordersize, defaultBeat.BorderColour);
                        }
                    });
                }

                function beatHitDetect() {
                    if (beats[0].length > 2) {
                        if (mouse[0] >= beats[0][1][0] - beats[0][2] && mouse[0] <= beats[0][1][0] + beats[0][2] && mouse[1] >= beats[0][1][1] - beats[0][2] && mouse[1] <= beats[0][1][1] + beats[0][2]) {
                            let Yintercept1 = Math.sqrt(Math.abs(Math.pow(beats[0][2], 2) - Math.pow(mouse[1] - beats[0][1][1], 2))) + beats[0][1][0];
                            let Yintercept2 = (-Math.sqrt(Math.abs(Math.pow(beats[0][2], 2) - Math.pow(mouse[1] - beats[0][1][1], 2)))) + beats[0][1][0];
                            colourRect(Yintercept2, mouse[1], 1, 1, "rgb(255,255,255,1)")
                            if (mouse[0] >= Yintercept2 && mouse[0] <= Yintercept1) {
                                beats[0] = "null";
                                beats = beats.filter(word => word != "null");
                            } else {
                                console.log("miss");
                            }
                        } else {
                            console.log("miss");
                        }
                    } else {
                        if (mouse[0] >= beats[0][1][0] - defaultBeat.radius && mouse[0] <= beats[0][1][0] + defaultBeat.radius && mouse[1] >= beats[0][1][1] - defaultBeat.radius && mouse[1] <= beats[0][1][1] + defaultBeat.radius) {
                            let Yintercept1 = Math.sqrt(Math.abs(Math.pow(defaultBeat.radius, 2) - Math.pow(mouse[1] - beats[0][1][1], 2))) + beats[0][1][0];
                            let Yintercept2 = (-Math.sqrt(Math.abs(Math.pow(defaultBeat.radius, 2) - Math.pow(mouse[1] - beats[0][1][1], 2)))) + beats[0][1][0];
                            colourRect(Yintercept2, mouse[1], 1, 1, "rgb(255,255,255,1)")
                            if (mouse[0] >= Yintercept2 && mouse[0] <= Yintercept1) {
                                beats[0] = "null";
                                beats = beats.filter(word => word != "null");
                            } else {
                                console.log("miss");
                            }
                        } else {
                            console.log("miss");
                        }
                    }
                }


                function addBeat(x, y, type) {


                }

                function resizeCanvas() {
                    canvas.width = canvas.clientWidth;
                    canvas.height = canvas.clientHeight;
                }

                function drawCircle(x, y, radius, c, borderwidth, bordercolour) {
                    canvasContext.strokeStyle = bordercolour;
                    canvasContext.lineWidth = borderwidth;
                    canvasContext.fillStyle = c;
                    canvasContext.beginPath();
                    canvasContext.arc(x, y, radius, 0, 2 * Math.PI);
                    canvasContext.stroke();
                    canvasContext.fill();
                }

                function colourRect(x, y, w, h, c) {
                    canvasContext.fillStyle = c;
                    canvasContext.fillRect(x, y, w, h)
                }

                function getMousePos(canvas, evt) {
                    var rect = canvas.getBoundingClientRect();
                    return {
                        x: evt.clientX - rect.left,
                        y: evt.clientY - rect.top
                    };
                }

            </script>
        </canvas>
    </div>
</body>

</html>

<style>
    div {
        width: 1000px;
        height: 1000px;
        position: relative
    }

    canvas {
        position: absolute;
        padding: 0;
        margin: 0;
        width: 100%;
        height: 56.25%;
    }

    * {
        margin: 0;
        padding: 0;
    }

</style>
